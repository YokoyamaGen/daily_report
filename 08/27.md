# 取り組んだ課題一覧
- データベース設計の課題
- REST WebAPI サービス 設計 | Udemy

# わかったこと
- SQL
    - ポリモーフィック関連はRailsのようなフレームワークを使用していない場合はアンチパターンになる。なぜなら、1つのカラムに複数のテーブルのデータが入るため、外部キーを貼れず、データの整合性が保てなくなる可能性があるため。
    - また、ER図の可読性が下がってしまうデメリットがある。
    - ポリモーフィック関連を使用すれば冗長性を排除できる。
    https://spice-factory.co.jp/development/has-and-belongs-to-many-table/

- WebAPIは規約の作り方やサービスの実装
- 副作用はデータが改変されること。副作用があるケースは更新処理。副作用がないのは取得処理。
- 安全とは副作用がない。読み取り専用の処理。GETメソッドが該当
- 冪等とは何度実行しても同じ状況が再現される。副作用は問わない。副作用がある更新処理はPUTやDELETE。副作用がないデータ取得はGETが該当する。
- 安全でも冪等でもないのがデータ登録であるPOST

- RESTとは設計ルールのこと。RESTfulとはRESTの原則に従っていること。
    - クライアント/サーバ
        - 画面とデータが分離している
        - クライアントがトリガーでサーバが受け身

    - 階層化システム
        - 多層アーキテクチャー構成。Web、AP、DBの構成。
        - メリットは再利用や進化
        - データ処理にオーバヘッドが発生

    - コードオンデマンド
        - リリース後に食らうあんとコードであるHTMLやJSを変更でき、クライアントは変更後のコードを利用できる。
        - メリットはリリース済みのクライアントに対して、機能追加できる。
        - サーバの負荷が下がる。
        - デメリットはブラウザが複数あるので、評価環境が複雑。
        
    - 統一インターフェース
        - リソースの識別。サーバ側に保持されるデータ。名前がつけられたリソースのこと。URIを用いてサーバに保存されたデータを識別する。
        - URIはリソースを識別するもの。URIには動作は含まない。
        - クライアントへレスポンスやサーバへPOSTするデータ。認証情報のようなメタデータを付与する。
        - データ自身がデータの中身を説明する。サーバへリクエストするデータ、クライアントへレスポンスするデータ。ヘッダーにメッセージ内容が何であるか記述されている。

    - ステートレス
        - 前の状態を保持していない。状態はサーバに保存せず、クライアント側に保存する。
    
    - キャッシュ制御
        - クライアントはレスポンスをキャッシュできる。

- URI設計
    - すべて小文字に統一する。
    - 単語はハイフンで繋げる。
    - 冗長な単語は削除する。
    - 誰が見てもわかるように省略しない。
    - 単語は複数形にする。URIで表現しているのはリソースの集合のため。
    - エンコードされた文字は使わない。URIから意味が理解できないため。
    - サーバ側のアーキテクチャーを反映しない。
    - システム依存の設計は意味が理解できないので、使用しない。betaやalphaなどのサーバの情報のようなものを含めいない。
    - ルールが統一されている。間違いを防ぐため。例えば、パスパラメーターとクエリーパラメーターが混在しているなら、統一する。
    - POSTはデータ作成時にリソース名が決まっていない。PUTはデータ作成時にリソース名が決まっている。

- クエリパラメーターは`?`の後にキーバリュー。例えば、page=3
- パスパラメーターは`users/123`。URLの中に含まれているパラメーター
- 一意なリソースを表すのに必要な場合は、パスパラメーター
- 省略可能かどうかの場合は、クエリパラメーター。検索条件などに使用される。

- ステータスコードの100は情報、300はリダイレクト、400はクライアント起因のエラー。REST APIでは300番台は使用しない。
- 201はリクエストが成功し、新しいリソースが作成されたことを示す。
- 204はリクエストは成功したが、レスポンスデータがないことを示す。クライアント側のビューを変更不要
- アクセス回数が制限を超えることをレートリミットという。429 Too Many Request
- 400のBad Requestは曖昧なエラー。401 Unauthorizedは認証されていない。403 Forbiddenは認可されていない。

- GETの成功は200以外にもキャッシュを利用する場合は、304 Not Modified。
- DELETEの成功は204 No Contentが一般的。削除した中身を返却しないため。

- データの内部構造
    - ヘッダー情報とかぶるエンベローブは使用しない。
    - オブジェクトはできるだけフラットにする。レスポンス容量を減らすため。
    - 日付はRFC3339形式を使用する。
    - プロパティ名はキャメルケースかスネークケースのどちらか一方に統一する。
    - 大きな数字は文字列で返す。整数は32bitで64bitを扱えないので。

- エラーでHTMLは返さない。
- エラー詳細はレスポンスボディに追加する。

- OAuthとOpenIDConnectの違いは、OpenIDはアクセストークンだけでなく、IDトークン(JWT)がサービスからサードパーティアプリへ返却される。
- JWTはジョットと読む。
- JWTは認証情報をサーバではなく、クライアント側で保存する。(ステートレスな通信の実現)


# 次やること
- タイピング
- スッキリわかるSQL入門 付録の問題
- チェリー本の復習
- RESTの課題

# 感じたこと
- ポリモーフィック関連について、理解が深まって嬉しかったです。実務で先輩が書いていたため、今後自分で実装できるようになりたいと思いました。
- WebAPIは今は先輩が作成したswaggerにURLやメソッドやステータスコードなどを書いてくれておりますが、今日学習したことをマスターして、自分でもできるようになりたいと思いました。
- API設計のページ番号に関するレスポンスが現場ではアンチパターンを踏んでいたため、今後は正確な設計ができるようになりたいと思いました。
- JWTの箇所がうまく理解できなかったため、今後使用することになったら、復習する。

# 学習時間
Today: 5 h 00 m

Total: 336 h 30 m



















































